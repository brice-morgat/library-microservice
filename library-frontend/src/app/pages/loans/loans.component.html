<p-toast></p-toast>
<section class="page-header">
  <div>
    <h2>Emprunts</h2>
    <p>Créer et suivre les prêts.</p>
  </div>
</section>

<div class="borrow-form card-surface">
  <h3>Nouvel emprunt</h3>
  <form [formGroup]="form" (ngSubmit)="borrow()">
    <div class="form-grid">
      <div class="field">
        <label>Utilisateur ID</label>
        <input pInputText type="number" formControlName="userId" />
      </div>
      <div class="field">
        <label>Livre ID</label>
        <input pInputText type="number" formControlName="bookId" />
      </div>
    </div>
    <button pButton class="p-button-danger" type="submit">Emprunter</button>
  </form>
</div>

<p-table [value]="loans" [loading]="loading" styleClass="p-datatable-striped">
  <ng-template pTemplate="header">
    <tr>
      <th>Emprunt</th>
      <th>Utilisateur</th>
      <th>Livre</th>
      <th>Statut</th>
      <th>Echéance</th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-loan>
    <tr>
      <td>#{{ loan.id }}</td>
      <td>{{ loan.userId }}</td>
      <td>{{ loan.bookId }}</td>
      <td><p-tag [severity]="statusSeverity(loan.status)" [value]="loan.status"></p-tag></td>
      <td>{{ loan.dueDate || '-' }}</td>
      <td>
        <button pButton class="p-button-text" icon="pi pi-refresh" (click)="returnLoan(loan)" [disabled]="loan.status === 'RETURNED'"></button>
      </td>
    </tr>
  </ng-template>
</p-table>
