<p-toast></p-toast>
<section class="page-header">
  <div>
    <h2>Catalogue</h2>
    <p>Gérez les livres et le stock disponible.</p>
  </div>
  <div class="actions">
    <input pInputText type="text" [(ngModel)]="searchTerm" placeholder="Rechercher..." />
    <button pButton class="p-button-outlined" (click)="search()">Rechercher</button>
    <button pButton class="p-button-danger" (click)="openCreate()">Nouveau livre</button>
  </div>
</section>

<p-table [value]="books" [loading]="loading" styleClass="p-datatable-striped">
  <ng-template pTemplate="header">
    <tr>
      <th>Titre</th>
      <th>Auteur</th>
      <th>Catégorie</th>
      <th>Copies</th>
      <th>Disponibles</th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-book>
    <tr>
      <td>{{ book.title }}</td>
      <td>{{ book.author?.firstName }} {{ book.author?.lastName }}</td>
      <td>{{ book.category?.name }}</td>
      <td>{{ book.totalCopies }}</td>
      <td>{{ book.availableCopies }}</td>
      <td class="table-actions">
        <a class="p-button p-button-text" [routerLink]="['/books', book.id]"><i class="pi pi-eye"></i></a>
        <button pButton class="p-button-text" icon="pi pi-pencil" (click)="openEdit(book)"></button>
        <button pButton class="p-button-text p-button-danger" icon="pi pi-trash" (click)="remove(book)"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog [(visible)]="dialogVisible" [modal]="true" [style]="{ width: '720px' }" header="Livre">
  <form [formGroup]="form" class="dialog-form">
    <div class="grid">
      <div class="field">
        <label>ISBN</label>
        <input pInputText formControlName="isbn" />
      </div>
      <div class="field">
        <label>Titre</label>
        <input pInputText formControlName="title" />
      </div>
      <div class="field">
        <label>Description</label>
        <textarea pInputTextarea rows="2" formControlName="description"></textarea>
      </div>
      <div class="field">
        <label>Année</label>
        <input pInputText type="number" formControlName="publicationYear" />
      </div>
      <div class="field">
        <label>Editeur</label>
        <input pInputText formControlName="publisher" />
      </div>
      <div class="field">
        <label>Total copies</label>
        <input pInputText type="number" formControlName="totalCopies" />
      </div>
      <div class="field">
        <label>Disponibles</label>
        <input pInputText type="number" formControlName="availableCopies" />
      </div>
      <div class="field">
        <label>Auteur prénom</label>
        <input pInputText formControlName="authorFirstName" />
      </div>
      <div class="field">
        <label>Auteur nom</label>
        <input pInputText formControlName="authorLastName" />
      </div>
      <div class="field">
        <label>Bio auteur</label>
        <textarea pInputTextarea rows="2" formControlName="authorBiography"></textarea>
      </div>
      <div class="field">
        <label>Catégorie</label>
        <input pInputText formControlName="categoryName" />
      </div>
      <div class="field">
        <label>Description catégorie</label>
        <textarea pInputTextarea rows="2" formControlName="categoryDescription"></textarea>
      </div>
    </div>
    <div class="dialog-actions">
      <button pButton class="p-button-text" type="button" (click)="dialogVisible=false">Annuler</button>
      <button pButton class="p-button-danger" type="button" (click)="save()">Enregistrer</button>
    </div>
  </form>
</p-dialog>
